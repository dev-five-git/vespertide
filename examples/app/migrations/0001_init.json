{
  "$schema": "https://raw.githubusercontent.com/dev-five-git/vespertide/refs/heads/main/schemas/migration.schema.json",
  "actions": [
    {
      "columns": [
        {
          "comment": null,
          "default": "gen_random_uuid()",
          "foreign_key": null,
          "index": null,
          "name": "id",
          "nullable": false,
          "primary_key": true,
          "type": "uuid",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": true,
          "name": "email",
          "nullable": false,
          "primary_key": null,
          "type": {
            "kind": "varchar",
            "length": 255
          },
          "unique": true
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "password",
          "nullable": false,
          "primary_key": null,
          "type": {
            "kind": "varchar",
            "length": 255
          },
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "name",
          "nullable": false,
          "primary_key": null,
          "type": {
            "kind": "varchar",
            "length": 100
          },
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "profile_image",
          "nullable": true,
          "primary_key": null,
          "type": "text",
          "unique": null
        },
        {
          "comment": null,
          "default": "now()",
          "foreign_key": null,
          "index": null,
          "name": "created_at",
          "nullable": false,
          "primary_key": null,
          "type": "timestamptz",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "updated_at",
          "nullable": true,
          "primary_key": null,
          "type": "timestamptz",
          "unique": null
        }
      ],
      "constraints": [
        {
          "auto_increment": false,
          "columns": [
            "id"
          ],
          "type": "primary_key"
        },
        {
          "columns": [
            "email"
          ],
          "name": null,
          "type": "unique"
        }
      ],
      "table": "user",
      "type": "create_table"
    },
    {
      "index": {
        "columns": [
          "email"
        ],
        "name": "idx_user_email",
        "unique": false
      },
      "table": "user",
      "type": "add_index"
    },
    {
      "columns": [
        {
          "comment": null,
          "default": "gen_random_uuid()",
          "foreign_key": null,
          "index": null,
          "name": "id",
          "nullable": false,
          "primary_key": true,
          "type": "uuid",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "name",
          "nullable": false,
          "primary_key": null,
          "type": {
            "kind": "varchar",
            "length": 100
          },
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "description",
          "nullable": true,
          "primary_key": null,
          "type": "text",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "logo",
          "nullable": true,
          "primary_key": null,
          "type": "text",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": {
            "on_delete": "cascade",
            "on_update": null,
            "ref_columns": [
              "id"
            ],
            "ref_table": "user"
          },
          "index": true,
          "name": "owner_id",
          "nullable": false,
          "primary_key": null,
          "type": "uuid",
          "unique": null
        },
        {
          "comment": null,
          "default": "now()",
          "foreign_key": null,
          "index": null,
          "name": "created_at",
          "nullable": false,
          "primary_key": null,
          "type": "timestamptz",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "updated_at",
          "nullable": true,
          "primary_key": null,
          "type": "timestamptz",
          "unique": null
        }
      ],
      "constraints": [
        {
          "auto_increment": false,
          "columns": [
            "id"
          ],
          "type": "primary_key"
        },
        {
          "columns": [
            "owner_id"
          ],
          "name": null,
          "on_delete": "cascade",
          "on_update": null,
          "ref_columns": [
            "id"
          ],
          "ref_table": "user",
          "type": "foreign_key"
        }
      ],
      "table": "media",
      "type": "create_table"
    },
    {
      "index": {
        "columns": [
          "owner_id"
        ],
        "name": "idx_media_owner_id",
        "unique": false
      },
      "table": "media",
      "type": "add_index"
    },
    {
      "columns": [
        {
          "comment": null,
          "default": null,
          "foreign_key": {
            "on_delete": "cascade",
            "on_update": null,
            "ref_columns": [
              "id"
            ],
            "ref_table": "media"
          },
          "index": null,
          "name": "media_id",
          "nullable": false,
          "primary_key": true,
          "type": "uuid",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "id",
          "nullable": false,
          "primary_key": true,
          "type": "big_int",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "title",
          "nullable": false,
          "primary_key": null,
          "type": {
            "kind": "varchar",
            "length": 500
          },
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "content",
          "nullable": false,
          "primary_key": null,
          "type": "text",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "summary",
          "nullable": true,
          "primary_key": null,
          "type": "text",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "thumbnail",
          "nullable": true,
          "primary_key": null,
          "type": "text",
          "unique": null
        },
        {
          "comment": null,
          "default": "'draft'",
          "foreign_key": null,
          "index": true,
          "name": "status",
          "nullable": false,
          "primary_key": null,
          "type": {
            "kind": "enum",
            "name": "article_status",
            "values": [
              "draft",
              "review",
              "published",
              "archived"
            ]
          },
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": true,
          "name": "published_at",
          "nullable": true,
          "primary_key": null,
          "type": "timestamptz",
          "unique": null
        },
        {
          "comment": null,
          "default": "now()",
          "foreign_key": null,
          "index": null,
          "name": "created_at",
          "nullable": false,
          "primary_key": null,
          "type": "timestamptz",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": null,
          "name": "updated_at",
          "nullable": true,
          "primary_key": null,
          "type": "timestamptz",
          "unique": null
        }
      ],
      "constraints": [
        {
          "auto_increment": false,
          "columns": [
            "media_id",
            "id"
          ],
          "type": "primary_key"
        },
        {
          "columns": [
            "media_id"
          ],
          "name": null,
          "on_delete": "cascade",
          "on_update": null,
          "ref_columns": [
            "id"
          ],
          "ref_table": "media",
          "type": "foreign_key"
        }
      ],
      "table": "article",
      "type": "create_table"
    },
    {
      "index": {
        "columns": [
          "status"
        ],
        "name": "idx_article_status",
        "unique": false
      },
      "table": "article",
      "type": "add_index"
    },
    {
      "index": {
        "columns": [
          "published_at"
        ],
        "name": "idx_article_published_at",
        "unique": false
      },
      "table": "article",
      "type": "add_index"
    },
    {
      "columns": [
        {
          "comment": null,
          "default": null,
          "foreign_key": {
            "on_delete": "cascade",
            "on_update": null,
            "ref_columns": [
              "id"
            ],
            "ref_table": "user"
          },
          "index": true,
          "name": "user_id",
          "nullable": false,
          "primary_key": true,
          "type": "uuid",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": {
            "on_delete": "cascade",
            "on_update": null,
            "ref_columns": [
              "id"
            ],
            "ref_table": "media"
          },
          "index": true,
          "name": "media_id",
          "nullable": false,
          "primary_key": true,
          "type": "uuid",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": null,
          "index": true,
          "name": "role",
          "nullable": false,
          "primary_key": null,
          "type": {
            "kind": "enum",
            "name": "media_role",
            "values": [
              "owner",
              "editor",
              "reporter"
            ]
          },
          "unique": null
        },
        {
          "comment": null,
          "default": "now()",
          "foreign_key": null,
          "index": null,
          "name": "created_at",
          "nullable": false,
          "primary_key": null,
          "type": "timestamptz",
          "unique": null
        }
      ],
      "constraints": [
        {
          "auto_increment": false,
          "columns": [
            "user_id",
            "media_id"
          ],
          "type": "primary_key"
        },
        {
          "columns": [
            "user_id"
          ],
          "name": null,
          "on_delete": "cascade",
          "on_update": null,
          "ref_columns": [
            "id"
          ],
          "ref_table": "user",
          "type": "foreign_key"
        },
        {
          "columns": [
            "media_id"
          ],
          "name": null,
          "on_delete": "cascade",
          "on_update": null,
          "ref_columns": [
            "id"
          ],
          "ref_table": "media",
          "type": "foreign_key"
        }
      ],
      "table": "user_media_role",
      "type": "create_table"
    },
    {
      "index": {
        "columns": [
          "user_id"
        ],
        "name": "idx_user_media_role_user_id",
        "unique": false
      },
      "table": "user_media_role",
      "type": "add_index"
    },
    {
      "index": {
        "columns": [
          "media_id"
        ],
        "name": "idx_user_media_role_media_id",
        "unique": false
      },
      "table": "user_media_role",
      "type": "add_index"
    },
    {
      "index": {
        "columns": [
          "role"
        ],
        "name": "idx_user_media_role_role",
        "unique": false
      },
      "table": "user_media_role",
      "type": "add_index"
    },
    {
      "columns": [
        {
          "comment": null,
          "default": null,
          "foreign_key": {
            "on_delete": "cascade",
            "on_update": null,
            "ref_columns": [
              "id"
            ],
            "ref_table": "article"
          },
          "index": null,
          "name": "article_id",
          "nullable": false,
          "primary_key": true,
          "type": "big_int",
          "unique": null
        },
        {
          "comment": null,
          "default": null,
          "foreign_key": {
            "on_delete": "cascade",
            "on_update": null,
            "ref_columns": [
              "id"
            ],
            "ref_table": "user"
          },
          "index": true,
          "name": "user_id",
          "nullable": false,
          "primary_key": true,
          "type": "uuid",
          "unique": null
        },
        {
          "comment": null,
          "default": "1",
          "foreign_key": null,
          "index": null,
          "name": "author_order",
          "nullable": false,
          "primary_key": null,
          "type": "integer",
          "unique": null
        },
        {
          "comment": null,
          "default": "'contributor'",
          "foreign_key": null,
          "index": null,
          "name": "role",
          "nullable": false,
          "primary_key": null,
          "type": {
            "kind": "enum",
            "name": "article_user_role",
            "values": [
              "lead",
              "contributor"
            ]
          },
          "unique": null
        },
        {
          "comment": null,
          "default": "now()",
          "foreign_key": null,
          "index": null,
          "name": "created_at",
          "nullable": false,
          "primary_key": null,
          "type": "timestamptz",
          "unique": null
        }
      ],
      "constraints": [
        {
          "auto_increment": false,
          "columns": [
            "article_id",
            "user_id"
          ],
          "type": "primary_key"
        },
        {
          "columns": [
            "article_id"
          ],
          "name": null,
          "on_delete": "cascade",
          "on_update": null,
          "ref_columns": [
            "id"
          ],
          "ref_table": "article",
          "type": "foreign_key"
        },
        {
          "columns": [
            "user_id"
          ],
          "name": null,
          "on_delete": "cascade",
          "on_update": null,
          "ref_columns": [
            "id"
          ],
          "ref_table": "user",
          "type": "foreign_key"
        }
      ],
      "table": "article_user",
      "type": "create_table"
    },
    {
      "index": {
        "columns": [
          "user_id"
        ],
        "name": "idx_article_user_user_id",
        "unique": false
      },
      "table": "article_user",
      "type": "add_index"
    }
  ],
  "comment": "Init",
  "created_at": "2025-12-18T17:16:53Z",
  "version": 1
}